<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP Anvil Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0; margin-bottom: 1rem;">
                <h1 style="margin: 0; font-size: 1.6rem;">Lloyd's <span style="color: #0057D2; font-weight: bold;">Anvil</span><span style="color: black; font-weight: bold;">izer</span></h1>
                <img src="{{ url_for('static', filename='images/saplogo.svg') }}" alt="SAP Logo" style="height: 32px; width: auto;">
            </div>

            <div class="upload-control">
                <label class="button">
                    <span>Choose Image</span>
                    <input type="file" id="file-input" accept="image/*" hidden>
                </label>
            </div>

            <div class="ratio-control">
                <p>Aspect Ratio:</p>
                <label><input type="radio" name="ratio" value="16:9" checked>16:9</label>
                <label><input type="radio" name="ratio" value="1:1">Square</label>
            </div>

            <div class="colour-control">
                <div id="colour-palette">
                    {% for name, hex in colours.items() %}
                    <span class="colour-swatch" title="{{ name }}" data-colour="{{ hex }}" style="background-color: {{ hex }};"></span>
                    {% endfor %}
                </div>
            </div>

            <!-- Modal for enlarged preview -->
            <div id="modal" class="modal" style="display: none;">
                <div class="modal-content large-preview-modal">
                    <span id="close-modal" class="close-modal">&times;</span>
                    <img id="modal-image" src="" alt="Preview">
                    <div class="modal-buttons">
                        <a id="modal-download" class="button quick-download" href="#" download>Download</a>
                        <button id="modal-advanced" class="button advanced-download">Advanced</button>
                    </div>
                </div>
            </div>

            <!-- High-Resolution Format Selection Modal -->
            <div id="highres-modal" class="modal" style="display: none;">
                <div class="modal-content highres-modal-content">
                    <span id="close-highres-modal" class="close-modal">&times;</span>
                    <h3>Print & Design Quality</h3>
                    <p>Choose your preferred format for high-resolution download:</p>
                    
                    <div class="format-options">
                        <label class="format-option">
                            <input type="radio" name="format" value="png" checked>
                            <div class="format-info">
                                <strong>PNG - High Resolution</strong>
                                <span>Flattened image up to 8K resolution (~30-50MB)</span>
                            </div>
                        </label>
                        
                        <label class="format-option">
                            <input type="radio" name="format" value="layers">
                            <div class="format-info">
                                <strong>Layer Package - ZIP</strong>
                                <span>Separate editable layers for professional editing (~80-120MB)</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="format-details">
                        <h4>Layer Package Contents:</h4>
                        <ul>
                            <li>01_background.png - Original cropped image</li>
                            <li>02_subject_cutout.png - Extracted subject (if available)</li>
                            <li>03_anvil_shape.png - Anvil overlay with transparency</li>
                            <li>final_composite.png - Final flattened result</li>
                            <li>README.txt - Usage instructions</li>
                        </ul>
                    </div>
                    
                    <div class="processing-warning">
                        <p>‚è±Ô∏è <strong>Processing time:</strong> 1-3 minutes for 8K images</p>
                        <p>üí° Works with Photoshop, GIMP, Figma, and other layer-capable editors</p>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="cancel-highres" class="button secondary-button">Cancel</button>
                        <button id="start-highres" class="button action-btn">Start Processing</button>
                    </div>
                </div>
            </div>

            <div class="opacity-control">
                <p>Silhouette Opacity:</p>
                <input type="range" id="opacity-slider" min="0" max="100" step="1" value="50">
            </div>

            <div class="crop-area">
                <div id="crop-wrapper" class="crop-wrapper">
                    <img id="image" alt="" style="display: none;">
                    <div id="crop-box" class="crop-box" style="display: none;"></div>

                    <!-- Anvil overlay preview -->
                    <div id="anvil-overlay" class="anvil-overlay" style="display: none;">
                        <svg viewBox="0 0 200 100" preserveAspectRatio="none" width="100%" height="100%">
                            <path d="M1,1 L199,1 L101,99 L1,99 Z"
                                  fill="none" stroke="#0070F2" stroke-width="2"
                                  stroke-linejoin="miter" stroke-linecap="butt"></path>
                        </svg>
                    </div>

                    <!-- Dark overlay to highlight crop area -->
                    <div id="mask-top" class="crop-mask" style="display: none;"></div>
                    <div id="mask-left" class="crop-mask" style="display: none;"></div>
                    <div id="mask-right" class="crop-mask" style="display: none;"></div>
                    <div id="mask-bottom" class="crop-mask" style="display: none;"></div>
                </div>

                <div class="zoom-control" style="display: none;">
                    <label for="zoom-slider">Zoom:</label>
                    <input type="range" id="zoom-slider" min="1" max="3" step="0.1" value="1">
                    <button id="fit-button" type="button" class="small-button">Fit</button>
                </div>

                <div class="anvil-size-control" style="display: none;">
                    <p>Anvil Size:</p>
                    <input type="range" id="anvil-size-slider" min="50" max="100" step="1" value="70">
                </div>

                <div class="anvil-offset-control" style="display: none;">
                    <p>Anvil Position:</p>
                    <div class="offset-control">
                        <label for="anvil-offset-x-slider">X:</label>
                        <input type="range" id="anvil-offset-x-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="offset-control">
                        <label for="anvil-offset-y-slider">Y:</label>
                        <input type="range" id="anvil-offset-y-slider" min="-100" max="100" step="1" value="0">
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button id="generate-btn" class="button action-btn" disabled style="flex: 1; margin-top: 0;">Generate Styles</button>
                <button id="reset-btn" class="button" style="flex: 0 0 auto; margin-top: 0; padding: 8px 12px;">Reset</button>
            </div>

            <div class="tip">
                <p>Tip: SAP brand requires you to use images from the SAP Brand Library or Adobe Stock. If you don‚Äôt have a license, you can request one
                   <a href="https://s1-eu.ariba.com/gb/itemDetail/0090919184%2524%2524ALM_50190112/catalog?realm=SAPGLOBAL" target="_blank">here</a>.</p>
                <p><a href="https://brand.sap.com/media-library/" target="_blank">SAP Brand Library</a> |
                   <a href="https://stock.adobe.com/" target="_blank">Adobe Stock</a></p>
            </div>
        </div>

        <div class="right-panel">
            <h2 id="preview-title">Examples</h2>
            <div id="example-instructions" class="example-instructions">
                <p>After uploading an image, you can:</p>
                <ul>
                    <li>Zoom in and move your selection</li>
                    <li>Move and resize the anvil shape</li>
                    <li>Change the opacity of the anvil</li>
                    <li>Choose from SAP brand-approved colors</li>
                </ul>
                <p><strong>Tips:</strong> Gradient and Flat styles work best with images without people. Human detection works better when the person is fully visible, not hidden behind objects.</p>
                <p id="download-hint" style="display: none;"><strong>üí° Click on any preview image to download!</strong></p>
            </div>
            <div id="previews" class="preview-grid">
                <!-- Sample previews shown by default -->
                <div class="preview-item sample-preview clickable-preview" data-style="Window">
                    <img src="{{ url_for('static', filename='images/previews/sample_window.png') }}" alt="Window Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Window</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
                <div class="preview-item sample-preview clickable-preview" data-style="Silhouette">
                    <img src="{{ url_for('static', filename='images/previews/sample_silhouette.png') }}" alt="Silhouette Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Silhouette</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
                <div class="preview-item sample-preview clickable-preview" data-style="Stroke">
                    <img src="{{ url_for('static', filename='images/previews/sample_stroke.png') }}" alt="Stroke Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Stroke</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
                <div class="preview-item sample-preview clickable-preview" data-style="Gradient Silhouette">
                    <img src="{{ url_for('static', filename='images/previews/sample_gradient_silhouette.png') }}" alt="Gradient Silhouette Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Gradient Silhouette</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
                <div class="preview-item sample-preview clickable-preview" data-style="Gradient">
                    <img src="{{ url_for('static', filename='images/previews/sample_gradient.png') }}" alt="Gradient Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Gradient</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
                <div class="preview-item sample-preview clickable-preview" data-style="Flat">
                    <img src="{{ url_for('static', filename='images/previews/sample_flat.png') }}" alt="Flat Style Sample">
                    <div class="preview-overlay">
                        <span class="preview-title">Flat</span>
                        <div class="preview-actions">
                            <span class="click-hint">üì• Click to download</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Usage counter positioned at bottom right -->
            <div id="usage-counter" class="usage-counter bottom-right">
                <span id="counter-text">üéØ 0 images processed</span>
            </div>
        </div>
    </div>

    <!-- Loading overlay displayed during processing -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-container">
            <div class="spinner large-spinner"></div>
            <div class="loading-text">Anvilization in Progress...</div>
            <div class="loading-subtext">Processing your image - this may take 30-60 seconds</div>
            <div class="processing-status-text">üîç Analyzing your masterpiece...</div>
            <div class="cpu-humor-text">üíª Powered by good old-fashioned CPU cycles - GPUs not included!</div>
        </div>
    </div>

    <!-- High-resolution processing overlay -->
    <div id="highres-loading-overlay" class="loading-overlay highres-loading" style="display: none;">
        <div class="loading-container">
            <div class="spinner large-spinner"></div>
            <div class="loading-text">Processing High-Resolution Image...</div>
            <div class="loading-subtext">This may take 30-60 seconds for 8K images</div>
            <div class="processing-status-text">Please wait while we enhance your image...</div>
            <div class="cpu-humor-text">üíª Powered by good old-fashioned CPU cycles - GPUs not included!</div>
        </div>
    </div>

    <!-- JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
